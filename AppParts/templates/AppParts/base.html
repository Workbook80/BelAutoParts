{% load static %}
{% load bootstrap4 %}

<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>BelGears - Запчасти Белгород</title>

	{% bootstrap_css %}
	{% bootstrap_javascript jquery='full' %}
	<!-- Подключение Bootstrap Icons-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
	<link href="{% static 'icon48.ico' %}" rel="icon" type="image/x-icon">
	<link href="{% static 'css/style.css' %}" rel="stylesheet">
</head>
<body class="custom-font">

<nav class="navbar navbar-expand-md navbar-dark bg-dark">
	<a class="navbar-brand" href='#'>
		<img src="{% static 'icon.png' %}" width="30" height="30" class="d-inline-block align-top" alt="">
		BelGears </a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
	        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarNav">
		<ul class="navbar-nav mr-auto">
			<li class="nav-item">
				<a class="nav-link" href="{% url 'AppParts:marks_view' %}">
					<i class="bi bi-gear"></i> Подбор запчасти
				</a>
			</li>
			{#			#}

			<li class="nav-item dropdown-center">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
				   aria-haspopup="true" aria-expanded="false">
					<i class="bi bi-tag"></i> Каталог
				</a>

				<div class="dropdown-menu" aria-labelledby="navbarDropdown"
				     style="margin: 10px; width: -webkit-fill-available;">
					<div class="row">
						<div class="col-md-6">
							<h4 class="dropdown-header text-center">Категории</h4>
							<ul class="list-unstyled">
								{% for category in categories %}
									{% if forloop.first %}
										<li><a class="dropdown-item" href="#"
										       data-category="{{ category.category_id }}">{{ category.category_name }}</a>
										</li>
									{% else %}
										<li><a class="dropdown-item" href="#"
										       data-category="{{ category.category_id }}">{{ category.category_name }}</a>
										</li>
									{% endif %}
								{% endfor %}
							</ul>
						</div>
						<div class="col-md-6">
							<h4 class="dropdown-header text-center">Подкатегории</h4>
							<div id="subcategory-container">
								<!-- Здесь будут отображаться подкатегории -->
							</div>
						</div>
					</div>
				</div>
			</li>

			{#			#}
			<li class="nav-item">
				<a class="nav-link" href="{% url 'AppParts:disassembly' %}">
					<i class="bi bi-tools"></i> Разборки
				</a>
			</li>
			<li class="nav-item">
				<a class="nav-link" href="{% url 'AppParts:contact' %}">
					<i class="bi bi-person"></i> Контакты
				</a>
			</li>
		</ul>
	</div>
</nav>

<div class="container-fluid mt-3 mb-3">
	<form class="form my-2 my-lg-0 order-lg-2 ml-lg-auto" method="get" action="{% url 'AppParts:parts_search' %}">
		<div class="input-group">
			<input class="form-control shadow-none" type="text" id="searchInput" name="search_query"
			       placeholder="Поиск по артикулу, наименованию или описанию" required>
			<div class="input-group-append">
				<button class="btn btn-outline-success" type="submit">
					<i class="bi bi-search"></i>
				</button>
			</div>
		</div>
	</form>
</div>


<div class="container-fluid">
	{% block content %}{% endblock %}
</div>

<!-- Подвал -->
<div class="container-fluid bg-dark text-light footer">
	<div class="row">
		<div class="col-sm-6 col-12 pt-3">
			<h5>Карта сайта:</h5>
			<a href="{% url 'AppParts:marks_view' %}" class="text-light text-decoration-none"><i class="bi bi-gear"></i>
				Подбор
				запчасти</a><br>
			<a href="#" class="text-light text-decoration-none"><i class="bi bi-tag"></i> Каталог</a><br>
			<a href="{% url 'AppParts:disassembly' %}" class="text-light text-decoration-none"><i
					class="bi bi-tools"></i> Разборки</a><br>
			<a href="{% url 'AppParts:contact' %}" class="text-light text-decoration-none"><i class="bi bi-person"></i>
				Контакты</a><br>
		</div>
		<div class="col-sm-6 col-12 pt-sm-3 text-sm-right">
			<h5>Контактная информация:</h5>
			<p class="mb-1"><i class="bi bi-envelope"></i> Почта: example@mail.com</p>
			<p class="mb-1"><i class="bi bi-phone"></i> Телефон: +123456789</p>
			<p class="mb-1"><i class="bi bi-geo-alt"></i> Адрес: Белгород, Садовая 7А</p>
			<p class="mb-1"><i class="bi bi-chat-square-dots"></i> Мы в Telegram: @razbor_10</p>
		</div>
	</div>
</div>


<script>
    $(document).ready(function () {
        // Предотвращаем закрытие меню при клике на категорию или подкатегорию
        $('.dropdown-menu').click(function (e) {
            e.stopPropagation();
        });

        // Отправка AJAX-запроса при клике на категорию
        $('.dropdown-item').click(function (e) {
            e.preventDefault();
            let categoryId = $(this).data('category');
            console.log('Category ID:', categoryId); // Отладочное сообщение
            console.log('Data attribute:', $(this).attr('data-category')); // Дополнительное отладочное сообщение
            console.log('Clicked item:', $(this).text()); // Дополнительное отладочное сообщение
            $.ajax({
                url: '/get_subcategories_nav/',
                type: 'GET',
                data: {'category_id': categoryId},
                success: function (response) {
                    // Очищаем контейнер перед добавлением новых подкатегорий
                    $('#subcategory-container').empty();

                    // Добавляем каждую подкатегорию в контейнер
                    response.subcategories.forEach(function (subcategory) {
                        $('#subcategory-container').append('<a class="dropdown-item" href="/catalog/' + subcategory.id + '">' + subcategory.name + '</a>');
                    });
                }
            });
        });
    });
</script>

</body>
</html>
