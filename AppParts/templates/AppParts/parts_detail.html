{% extends 'AppParts/base.html' %}

{% block early_page %}
	<div class="input-group-append">
		<a href="javascript:history.go(-1);" class="btn btn-danger shadow-none rounded-left">
			<i class="bi bi-arrow-left-square"> {{ part.subcategory }}</i></a>
	</div>
{% endblock %}

{% block content %}

	<div class="row">
		<div class="col-lg-6 mx-auto">
			<h4>{{ part.part_name }}</h4>
			{% if part.description %}
				<h6>Описание: {{ part.description }}</h6>
			{% endif %}
			<h6>Артикул: {{ part.code }}</h6>
			<h6>Наличие:
				{% if part.availability %}
					<span class="text-success">Есть в наличии</span> <i class="bi bi-check-circle"></i>
				{% else %}
					<span class="text-danger">Нет в наличии</span> <i class="bi bi-x-circle"></i>
				{% endif %}
			</h6>
			<h6>Цена: {{ part.formatted_price }} &#8381;</h6>

			<h4>Поддерживаемые модели:</h4>
			<p>
				{% for model in part.model.all %}
					{{ model.model_name }}
				{% endfor %}
			</p>
			<!-- Кнопка для открытия модального окна -->
			<button type="button" class="btn btn-lg btn-success shadow-none" data-toggle="modal"
			        data-target="#orderModal">
				Оставить заявку
			</button>

			<!-- Модальное окно -->
			<div class="modal fade" id="orderModal" tabindex="-1" role="dialog" aria-labelledby="orderModalLabel"
			     aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title text-center" id="orderModalLabel">Оставить заявку</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>

						<div class="modal-body">
							<div id="modal-message"></div>
							<!-- Остальное содержимое модального окна -->
							<div class="modal-body">
								<!-- Форма заявки -->
								<form action="{% url 'AppParts:part_detail' part.part_id %}" method="post">
									{% csrf_token %}
									<div class="form-group">
										<label for="order_name">Ваше имя:</label>
										<input type="text" class="form-control" id="order_name" name="order_name"
										       required>
									</div>
									<div class="form-group">
										<label for="order_phone">Номер телефона:</label>
										<input type="tel" class="form-control" id="order_phone" name="order_phone"
										       required>
									</div>
									<div class="form-group">
										<div class="g-recaptcha" data-sitekey={{ RECAPTCHA_PUBLIC_KEY }}></div>
									</div>
									<!-- Если вам нужно отправить part_name и part_code -->
									<input type="hidden" name="part_name" value="{{ part.part_name }}">
									<input type="hidden" name="part_code" value="{{ part.code }}">
									<div class="text-center">
										<button type="submit" class="btn btn-success btn-lg shadow-none">Отправить
										</button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-lg-6 mx-auto">
			<div id="carouselPart" class="carousel slide p-3" data-ride="carousel">
				<div class="carousel-inner">
					{% if part.image_url_part %}
						<div class="carousel-item active">
							<img src="{{ part.image_url_part.url }}" class="d-block w-100 rounded"
							     alt="{{ part.part_name }} Image">
						</div>
					{% endif %}
					{% if part.additional_image_one %}
						<div class="carousel-item">
							<img src="{{ part.additional_image_one.url }}" class="d-block w-100 rounded"
							     alt="{{ part.part_name }} Image_1">
						</div>
					{% endif %}
					{% if part.additional_image_two %}
						<div class="carousel-item">
							<img src="{{ part.additional_image_two.url }}" class="d-block w-100 rounded"
							     alt="{{ part.part_name }} Image_2">
						</div>
					{% endif %}
					{% if part.additional_image_three %}
						<div class="carousel-item">
							<img src="{{ part.additional_image_three.url }}" class="d-block w-100 rounded"
							     alt="{{ part.part_name }} Image_3">
						</div>
					{% endif %}
				</div>
				{% if part.additional_image_one or part.additional_image_two or part.additional_image_three %}
					<a class="carousel-control-prev" href="#carouselPart" role="button" data-slide="prev">
						<span class="carousel-control-prev-icon" aria-hidden="true"></span>
						<span class="sr-only">Previous</span>
					</a>
					<a class="carousel-control-next" href="#carouselPart" role="button" data-slide="next">
						<span class="carousel-control-next-icon" aria-hidden="true"></span>
						<span class="sr-only">Next</span>
					</a>
				{% endif %}
			</div>
		</div>
	</div>

	<script src="https://www.google.com/recaptcha/api.js" async defer></script>

	<script>
        $(document).ready(function () {
            $('form').submit(function (event) {
                event.preventDefault(); // Предотвращаем отправку формы по умолчанию
                let formData = $(this).serialize();// Получаем данные формы
                let form = this;
                $.ajax({
                    type: 'POST',
                    url: $(this).attr('action'),
                    data: formData,
                    success: function (response) {
                        // Сбрасываем данные формы
                        $(form)[0].reset();
                        // Сбрасываем состояние капчи
                        grecaptcha.reset();
                        $('#modal-message').html('<div class="alert alert-success text-center" role="alert">' + response.message + '</div>');
                    },
                    error: function (response) {
                        $('#modal-message').html('<div class="alert alert-danger text-center" role="alert">' + response.responseJSON.message + '</div>');
                    }
                });
            });
        });
	</script>


{% endblock %}